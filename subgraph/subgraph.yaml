specVersion: 0.0.5
schema:
  file: ./schema.graphql
dataSources:
  # Dynamic Market Maker - Swap events, price updates
  - kind: ethereum
    name: DynamicMarketMaker
    network: eto-l1
    source:
      address: "0xd14Ea79ab8B06BD5D2F4c805b3D9F6D134002648"
      abi: DynamicMarketMaker
      startBlock: 1
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Swap
        - PriceUpdate
        - LiquidityEvent
      abis:
        - name: DynamicMarketMaker
          file: ./abis/DynamicMarketMaker.json
      eventHandlers:
        - event: Swap(indexed address,indexed address,indexed address,uint256,uint256,uint256)
          handler: handleSwap
        - event: LiquidityAdded(indexed address,uint256,uint256,uint256)
          handler: handleLiquidityAdded
        - event: LiquidityRemoved(indexed address,uint256,uint256,uint256)
          handler: handleLiquidityRemoved
      file: ./src/dmm.ts

  # SMAANG Vault - Deposits, Withdrawals, Drips
  - kind: ethereum
    name: SmaangVault
    network: eto-l1
    source:
      address: "0xed2EEd3257Ce0A9ECeeE1055b5e54E724E63c09a"
      abi: SmaangVault
      startBlock: 1
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Deposit
        - Withdrawal
        - DripEvent
        - VaultSnapshot
      abis:
        - name: SmaangVault
          file: ./abis/SmaangVault.json
      eventHandlers:
        # Deposit event - topic0: 0xcf75a80a22cde0edcefe708f860e644c73eb8921aac7890f3bec010eef965f64
        # Structure: (address indexed owner, uint256 assets, uint256 shares)
        - event: VaultDeposit(indexed address,uint256,uint256)
          handler: handleDeposit
          topic0: "0xcf75a80a22cde0edcefe708f860e644c73eb8921aac7890f3bec010eef965f64"
        # DripCommitted event - topic0: 0xdd90d87ade8de9e2a981cbd9ee8f6104b45abe962b1fe73be270d576ac841cb0
        # Structure: (bytes32 indexed commitment, address indexed keeper)
        - event: DripCommitted(indexed bytes32,indexed address)
          handler: handleDripCommitted
        # DripExecuted event - topic0: 0x69c32473484beb157bc3edf9bb9485f0c7e70e274354c77ad37acd5e074f744b
        # Structure: (uint256 dmmMAANG, uint256 dmmUSDC, uint256 psmMAANG, uint256 psmUSDC)
        - event: DripExecuted(uint256,uint256,uint256,uint256)
          handler: handleDripExecuted
      file: ./src/vault.ts

  # Oracle Aggregator - Price feed updates
  - kind: ethereum
    name: OracleAggregator
    network: eto-l1
    source:
      address: "0x432edDe96fca51943b2a65b889ED50De7E51BdF7"
      abi: OracleAggregator
      startBlock: 1
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - OraclePriceUpdate
      abis:
        - name: OracleAggregator
          file: ./abis/OracleAggregator.json
      eventHandlers:
        - event: PriceUpdated(uint256,uint256)
          handler: handlePriceUpdated
      file: ./src/oracle.ts

