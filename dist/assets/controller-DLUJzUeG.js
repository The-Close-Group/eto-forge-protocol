const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-C4sJSsCB.js","assets/index-7FzYWXJd.js","assets/index-BvNXXA0f.css"])))=>i.map(i=>d[i]);
import{g as $,n as U,a as m,b as S,_ as j,c as w,D as W,U as z,S as H,N as V,s as J,d as I,e as A,t as K,f as Y,u as B,p as G,h as Q,v as X,i as Z,j as x,k as b,l as O}from"./index-7FzYWXJd.js";let _=null;const D={lastUsedChainId:"tw.wc.lastUsedChainId",requestedChains:"tw.wc.requestedChains"};async function cn(n,s,t,i,a){var g,y,q;const e=await L(n,t,a),c=n.walletConnect;let{onDisplayUri:d}=c||{};if(!d&&a){const C=await S(t);d=P=>{const E=C.mobile.native||C.mobile.universal;if(!E){a(P);return}const F=O(E,P).redirect;a(F)}}d&&e.events.addListener("display_uri",d);let r=c==null?void 0:c.optionalChains,h=n.chain;t==="global.safe"&&(r=k.map(m),h&&!r.includes(h)&&(h=void 0));const{chains:l,rpcMap:o}=an({chain:h,client:n.client,optionalChains:r});e.session||await e.connect({...c!=null&&c.pairingTopic?{pairingTopic:c==null?void 0:c.pairingTopic}:{},namespaces:{[V]:{chains:l,events:["chainChanged","accountsChanged"],methods:["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData","wallet_switchEthereumChain","wallet_addEthereumChain"],rpcMap:o}}}),N(l.map(C=>Number(C.split(":")[1])),i);const u=((g=l[0])==null?void 0:g.split(":")[1])||1,f=U(u),T=(await e.request({method:"eth_requestAccounts",params:[]},`eip155:${f}`))[0];if(!T)throw new Error("No accounts found on provider.");const v=n.chain&&n.chain.id===f?n.chain:m(f);if(n){const C={chain:n.chain,optionalChains:(y=n.walletConnect)==null?void 0:y.optionalChains,pairingTopic:(q=n.walletConnect)==null?void 0:q.pairingTopic};i&&J(i,t,C)}return c!=null&&c.onDisplayUri&&e.events.removeListener("display_uri",c.onDisplayUri),M(T,v,e,s,i,n.client)}async function sn(n,s,t,i,a){var u;const e=i?await $(i,t):null,c=await L(e?{chain:e.chain,client:n.client,walletConnect:{optionalChains:e.optionalChains,pairingTopic:e.pairingTopic}}:{client:n.client,walletConnect:{}},t,a),r=(await c.enable())[0];if(!r)throw new Error("No accounts found on provider.");const h=((u=n.chain)==null?void 0:u.id)||1,l=U(h),o=n.chain&&n.chain.id===l?n.chain:m(l);return M(r,o,c,s,i,n.client)}async function L(n,s,t){var h,l,o,u;if(_)return _;const i=await S(s),a=n.walletConnect,{UniversalProvider:e}=await j(async()=>{const{UniversalProvider:f}=await import("./index.es-C4sJSsCB.js").then(p=>p.k);return{UniversalProvider:f}},__vite__mapDeps([0,1,2]));let c=a==null?void 0:a.optionalChains,d=n.chain;s==="global.safe"&&(c=k.map(m),d&&!c.includes(d)&&(d=void 0));const r=await e.init({metadata:{description:((h=a==null?void 0:a.appMetadata)==null?void 0:h.description)||w().description,icons:[((l=a==null?void 0:a.appMetadata)==null?void 0:l.logoUrl)||w().logoUrl],name:((o=a==null?void 0:a.appMetadata)==null?void 0:o.name)||w().name,url:((u=a==null?void 0:a.appMetadata)==null?void 0:u.url)||w().url},projectId:(a==null?void 0:a.projectId)||W});if(r.events.setMaxListeners(Number.POSITIVE_INFINITY),s!=="walletConnect"){async function f(){var T,v,g,y;const p=((y=(g=(v=(T=r.session)==null?void 0:T.peer)==null?void 0:v.metadata)==null?void 0:g.redirect)==null?void 0:y.native)||i.mobile.native||i.mobile.universal;t&&p&&await t(p)}r.on("session_request_sent",f),r.events.addListener("disconnect",()=>{r.off("session_request_sent",f),_=null})}return _=r,r}function R({provider:n,address:s,client:t,chain:i}){return{address:I(s),async sendTransaction(e){const c=await n.request({method:"eth_sendTransaction",params:[{data:e.data,from:I(s),gas:e.gas?A(e.gas):void 0,to:e.to,value:e.value?A(e.value):void 0}]},`eip155:${e.chainId}`);return K({chainId:e.chainId,client:t,contractAddress:e.to??void 0,gasPrice:e.gasPrice,transactionHash:c,walletAddress:I(s),walletType:"walletConnect"}),{transactionHash:c}},async signMessage({message:e}){const c=typeof e=="string"?Y(e):e.raw instanceof Uint8Array?B(e.raw):e.raw;return n.request({method:"personal_sign",params:[c,this.address]},`eip155:${i.id}`)},async signTypedData(e){const c=G(e),{domain:d,message:r,primaryType:h}=c,l={EIP712Domain:Q({domain:d}),...c.types};X({domain:d,message:r,primaryType:h,types:l});const o=Z({domain:d??{},message:r,primaryType:h,types:l});return await n.request({method:"eth_signTypedData_v4",params:[this.address,o]},`eip155:${i.id}`)}}}function M(n,s,t,i,a,e){const c=R({address:n,chain:s,client:e,provider:t});async function d(){t.removeListener("accountsChanged",h),t.removeListener("chainChanged",l),t.removeListener("disconnect",r),await t.disconnect(),_=null}function r(){N([],a),a==null||a.removeItem(D.lastUsedChainId),d(),i.emit("disconnect",void 0)}function h(o){if(o[0]){const u=R({address:I(o[0]),chain:s,client:e,provider:t});i.emit("accountChanged",u),i.emit("accountsChanged",o)}else r()}function l(o){const u=m(U(o));i.emit("chainChanged",u),a==null||a.setItem(D.lastUsedChainId,String(o))}return t.on("accountsChanged",h),t.on("chainChanged",l),t.on("disconnect",r),t.on("session_delete",r),[c,s,d,o=>nn(t,o)]}async function nn(n,s){const t=s.id;try{n.setDefaultChain(`eip155:${t}`)}catch(i){const a=typeof i=="string"?i:i==null?void 0:i.message;throw/user rejected request/i.test(a)?new z(i):new H(i)}}function N(n,s){s==null||s.setItem(D.requestedChains,x(n))}function an(n){const s={},t=[];n.chain&&(s[n.chain.id]=b({chain:n.chain,client:n.client}),t.push(n.chain.id));const i=((n==null?void 0:n.optionalChains)||[]).slice(0,10);for(const a of i)s[a.id]=b({chain:a,client:n.client}),t.push(a.id);return!n.chain&&i.length===0&&(s[1]=m(1).rpc,t.push(1)),{chains:t.map(a=>`eip155:${a}`),rpcMap:s}}const k=[1,11155111,42161,43114,8453,1313161554,84532,56,42220,100,10,137,1101,324,534352];export{sn as autoConnectWC,cn as connectWC};
