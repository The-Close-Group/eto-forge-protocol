const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-7FzYWXJd.js","assets/index-BvNXXA0f.css","assets/signing-3BqqlBFA.js","assets/concat-hex-VSGmPXkP.js","assets/Signature-DfxtM4eh.js","assets/send-eip712-transaction-URYjv6NB.js","assets/eth_sendRawTransaction-DPdnXbFR.js"])))=>i.map(i=>d[i]);
import{bu as mt,a6 as z,f as K,C as x,bv as C,bw as W,_ as N,bx as ut,a8 as j,by as Z,bz as pt,bk as Y,az as F,aP as O,bA as D,bB as Q,bC as yt,j as J,a3 as S,bD as b,bE as lt,bF as ft,bG as k,a4 as H,a5 as L,bH as wt,bI as At,bJ as ht,bK as X,aa as gt,A as Gt,aQ as Tt,bL as vt,bM as _,aL as Pt,a7 as P,bN as tt,bO as xt,bl as Lt,bP as Ot,aW as Dt,d as et,a as E,t as U,aR as bt,bQ as St,bR as Ct,p as Ft,bS as Et,bT as _t,bU as Ut,bV as Vt}from"./index-7FzYWXJd.js";import{t as It,p as Nt,s as $t}from"./send-eip712-transaction-URYjv6NB.js";async function Rt(e){const{factoryContract:a,predictAddressOverride:t,adminAddress:r,accountSalt:c,accountAddress:n}=e;if(t)return t(a,r);if(n)return n;if(!r)throw new Error("Account address is required to predict the smart wallet address.");return mt(async()=>{const i=c&&z(c)?c:K(c??"");let s,o=0;const u=3;for(;o<=u;)try{s=await x({contract:a,method:"function getAddress(address, bytes) returns (address)",params:[r,i]});break}catch(y){if(o===u)throw y;const l=2**(o+1)*200;await new Promise(d=>setTimeout(d,l)),o++}if(!s)throw new Error(`No smart account address found for admin address ${r} and salt ${c}`);return s},{cacheKey:`${e.factoryContract.chain.id}-${e.factoryContract.address}-${e.adminAddress}-${e.accountSalt}`,cacheTime:1e3*60*60*24})}function at(e){const{adminAddress:a,factoryContract:t,createAccountOverride:r,accountSalt:c}=e;if(r)return r(t,a);const n=c&&z(c)?c:K(c??"");return C({contract:t,method:"function createAccount(address, bytes) returns (address)",params:[a,n]})}function nt(e){const{accountContract:a,transaction:t,executeOverride:r}=e;if(r)return r(a,t);let c=t.value||0n;return(t.chainId===295||t.chainId===296)&&(c=BigInt(c)/BigInt(10**10)),C({contract:a,gas:t.gas?t.gas+21000n:void 0,method:"function execute(address, uint256, bytes)",params:[t.to||"",c,t.data||"0x"]})}function kt(e){var i;const{accountContract:a,transactions:t,executeBatchOverride:r}=e;if(r)return r(a,t);let c=t.map(s=>s.value||0n);const n=(i=t[0])==null?void 0:i.chainId;return(n===295||n===296)&&(c=c.map(s=>BigInt(s)/BigInt(10**10))),C({contract:a,method:"function executeBatch(address[], uint256[], bytes[])",params:[t.map(s=>s.to||""),c,t.map(s=>s.data||"0x")]})}const Ht="0xdd62ed3e",Bt=[{name:"owner",type:"address"},{name:"spender",type:"address"}],Mt=[{type:"uint256"}];async function qt(e){return x({contract:e.contract,method:[Ht,Bt,Mt],params:[e.owner,e.spender]})}const zt="0x095ea7b3",Kt=[{name:"spender",type:"address"},{name:"value",type:"uint256"}],Wt=[{type:"bool"}];function jt(e){const a=W(async()=>"asyncParams"in e?await e.asyncParams():e);return C({accessList:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.accessList},authorizationList:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.authorizationList},contract:e.contract,erc20Value:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.erc20Value},extraGas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.extraGas},gas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.gas},gasPrice:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.gasPrice},maxFeePerGas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.maxFeePerGas},maxPriorityFeePerGas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.maxPriorityFeePerGas},method:[zt,Kt,Wt],nonce:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.nonce},params:async()=>{const t=await a();return[t.spender,t.value]},value:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.value}})}function Zt(e){return jt({asyncParams:async()=>{let a;if("amount"in e){const{decimals:t}=await N(async()=>{const{decimals:c}=await import("./index-7FzYWXJd.js").then(n=>n.iS);return{decimals:c}},__vite__mapDeps([0,1])),r=await t(e).catch(()=>18);a=ut(e.amount.toString(),r)}else a=e.amountWei;return{overrides:{erc20Value:{amountWei:a,tokenAddress:e.contract.address}},spender:e.spender,value:a}},contract:e.contract})}const Yt="0xf15d424e",Qt=[{name:"signer",type:"address"}],Jt=[{components:[{name:"signer",type:"address"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"startTimestamp",type:"uint128"},{name:"endTimestamp",type:"uint128"}],name:"permissions",type:"tuple"}];async function Xt(e){return x({contract:e.contract,method:[Yt,Qt,Jt],params:[e.signer]})}const te="0x5892e236",ee=[{components:[{name:"signer",type:"address"},{name:"isAdmin",type:"uint8"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"permissionStartTimestamp",type:"uint128"},{name:"permissionEndTimestamp",type:"uint128"},{name:"reqValidityStartTimestamp",type:"uint128"},{name:"reqValidityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}],name:"req",type:"tuple"},{name:"signature",type:"bytes"}],ae=[];function ne(e){const a=W(async()=>"asyncParams"in e?await e.asyncParams():e);return C({accessList:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.accessList},authorizationList:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.authorizationList},contract:e.contract,erc20Value:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.erc20Value},extraGas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.extraGas},gas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.gas},gasPrice:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.gasPrice},maxFeePerGas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.maxFeePerGas},maxPriorityFeePerGas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.maxPriorityFeePerGas},method:[te,ee,ae],nonce:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.nonce},params:async()=>{const t=await a();return[t.req,t.signature]},value:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.value}})}function q(){return new Date(Date.now()+1e3*60*60*24*365*10)}function I(e){return It(Math.floor(e.getTime()/1e3))}const se=[{name:"signer",type:"address"},{name:"isAdmin",type:"uint8"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"permissionStartTimestamp",type:"uint128"},{name:"permissionEndTimestamp",type:"uint128"},{name:"reqValidityStartTimestamp",type:"uint128"},{name:"reqValidityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}];async function re(e){const{account:a,contract:t,req:r}=e,c=await a.signTypedData({domain:{chainId:t.chain.id,name:"Account",verifyingContract:t.address,version:"1"},message:r,primaryType:"SignerPermissionRequest",types:{SignerPermissionRequest:se}});return{req:r,signature:c}}async function ie(e){var r;const{target:a,permissions:t}=e;return{approvedTargets:t.approvedTargets==="*"?[j]:t.approvedTargets,isAdmin:0,nativeTokenLimitPerTransaction:Z(((r=t.nativeTokenLimitPerTransaction)==null?void 0:r.toString())||"0"),permissionEndTimestamp:I(t.permissionEndTimestamp||q()),permissionStartTimestamp:I(t.permissionStartTimestamp||new Date(0)),reqValidityEndTimestamp:I(q()),reqValidityStartTimestamp:0n,signer:a,uid:await pt()}}function ce(e){const{contract:a,sessionKeyAddress:t,account:r,permissions:c}=e;return ne({async asyncParams(){const{req:n,signature:i}=await re({account:r,contract:a,req:await ie({permissions:c,target:t})});return{req:n,signature:i}},contract:a})}async function oe(e){var i;const{accountContract:a,sessionKeyAddress:t,newPermissions:r}=e;if(!await Y(a))return!0;const n=await Xt({contract:a,signer:t});return!!(n.endTimestamp&&n.endTimestamp<Math.floor(Date.now()/1e3)||!de(n.approvedTargets,r.approvedTargets)||Z(((i=r.nativeTokenLimitPerTransaction)==null?void 0:i.toString())??"0")>n.nativeTokenLimitPerTransaction)}function de(e,a){return a==="*"&&e.length===1&&e[0]===j?!0:a!=="*"?a.map(t=>t.toLowerCase()).every(t=>e.map(r=>r.toLowerCase()).includes(t)):!1}const me=2n**96n-1n,ue="0x35567e1a",pe=[{name:"sender",type:"address"},{name:"key",type:"uint192"}],ye=[{name:"nonce",type:"uint256"}];async function le(e){return x({contract:e.contract,method:[ue,pe,ye],params:[e.sender,e.key]})}const fe="0xa6193531",we=[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"callGasLimit",type:"uint256"},{name:"verificationGasLimit",type:"uint256"},{name:"preVerificationGas",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"userOp",type:"tuple"}],Ae=[{type:"bytes32"}];async function he(e){return x({contract:e.contract,method:[fe,we,Ae],params:[e.userOp]})}const ge="0x22cdde4c",Ge=[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"accountGasLimits",type:"bytes32"},{name:"preVerificationGas",type:"uint256"},{name:"gasFees",type:"bytes32"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"userOp",type:"tuple"}],Te=[{type:"bytes32"}];async function ve(e){return x({contract:e.contract,method:[ge,Ge,Te],params:[e.userOp]})}function Pe(e){return e.factory?F([e.factory,e.factoryData||"0x"]):"0x"}function xe(e){return F([O(D(BigInt(e.verificationGasLimit)),{size:16}),O(D(BigInt(e.callGasLimit)),{size:16})])}function Le(e){return F([O(D(BigInt(e.maxPriorityFeePerGas)),{size:16}),O(D(BigInt(e.maxFeePerGas)),{size:16})])}function Oe(e){return e.paymaster?F([e.paymaster,O(D(BigInt(e.paymasterVerificationGasLimit||0)),{size:16}),O(D(BigInt(e.paymasterPostOpGasLimit||0)),{size:16}),e.paymasterData||"0x"]):"0x"}const De=e=>({accountGasLimits:xe(e),callData:e.callData,gasFees:Le(e),initCode:Pe(e),nonce:BigInt(e.nonce),paymasterAndData:Oe(e),preVerificationGas:BigInt(e.preVerificationGas),sender:e.sender,signature:e.signature});async function V(e){var h;const{userOp:a,paymasterOverride:t,client:r,chain:c,entrypointAddress:n}=e;if(t)return t(a);const i={"Content-Type":"application/json"},s=n??b,o=Q(c),u={id:1,jsonrpc:"2.0",method:"pm_sponsorUserOperation",params:[yt(a),s]},l=await lt(r)(o,{body:J(u),headers:i,method:"POST"});if(!l.ok){const g=await l.text()||l.statusText;throw new Error(`Paymaster error: ${l.status} - ${g}`)}const d=await l.json();if(d.result)return typeof d.result=="string"?{paymasterAndData:d.result}:(d.result.reason&&console.warn(`Paymaster policy rejected this transaction with reason: ${d.result.reason} ${d.result.policyId?`(policyId: ${d.result.policyId})`:""}`),{callGasLimit:d.result.callGasLimit?S(d.result.callGasLimit):void 0,paymaster:d.result.paymaster,paymasterAndData:d.result.paymasterAndData,paymasterData:d.result.paymasterData,paymasterPostOpGasLimit:d.result.paymasterPostOpGasLimit?S(d.result.paymasterPostOpGasLimit):void 0,paymasterVerificationGasLimit:d.result.paymasterVerificationGasLimit?S(d.result.paymasterVerificationGasLimit):void 0,preVerificationGas:d.result.preVerificationGas?S(d.result.preVerificationGas):void 0,verificationGasLimit:d.result.verificationGasLimit?S(d.result.verificationGasLimit):void 0});const A=((h=d.error)==null?void 0:h.message)||d.error||l.statusText||"unknown error";throw new Error(`Paymaster error from ${o}: ${A}`)}const B=new Set,M=e=>`${e.chain.id}:${e.address}`,st=e=>{B.add(M(e))},rt=e=>{B.delete(M(e))},it=e=>B.has(M(e));async function be(e){const a=e.timeoutMs||12e4,t=e.intervalMs||1e3,r=Date.now()+a;for(;Date.now()<r;){const c=await ft(e);if(c)return c;await new Promise(n=>setTimeout(n,t))}throw new Error(`Timeout waiting for userOp to be mined on chain ${e.chain.id} with UserOp hash: ${e.userOpHash}`)}async function Se(e){var w;const{transaction:a,accountContract:t,factoryContract:r,adminAddress:c,overrides:n,sponsorGas:i,waitForDeployment:s=!0,isDeployedOverride:o}=e,u=a.chain,y=a.client,l={bundlerUrl:n==null?void 0:n.bundlerUrl,chain:u,client:y,entrypointAddress:n==null?void 0:n.entrypointAddress},d=k(((w=e.overrides)==null?void 0:w.entrypointAddress)||b),[A,h,g,G,f]=await Promise.all([typeof o=="boolean"?o:Y(t).then(T=>T||it(t)),H(a),L(a.gas),Ce({bundlerOptions:l,chain:u,client:y,executeTx:a}),Ie({accountContract:t,chain:u,client:y,entrypointAddress:n==null?void 0:n.entrypointAddress,getNonceOverride:n==null?void 0:n.getAccountNonce})]),{maxFeePerGas:m,maxPriorityFeePerGas:p}=G;return d==="v0.7"?Fe({accountContract:t,adminAddress:c,bundlerOptions:l,callData:h,callGasLimit:g,factoryContract:r,isDeployed:A,maxFeePerGas:m,maxPriorityFeePerGas:p,nonce:f,overrides:n,sponsorGas:i,waitForDeployment:s}):Ee({accountContract:t,adminAddress:c,bundlerOptions:l,callData:h,callGasLimit:g,factoryContract:r,isDeployed:A,maxFeePerGas:m,maxPriorityFeePerGas:p,nonce:f,overrides:n,sponsorGas:i,waitForDeployment:s})}async function Ce(e){const{executeTx:a,bundlerOptions:t,chain:r,client:c}=e;let{maxFeePerGas:n,maxPriorityFeePerGas:i}=a;const s=(t==null?void 0:t.bundlerUrl)??Q(r);if(wt(s)){const o=await At({options:t});n=o.maxFeePerGas,i=o.maxPriorityFeePerGas}else{const[o,u]=await Promise.all([L(n),L(i)]);if(o&&u)n=o,i=u;else{const y=await ht(c,r);i=u??y.maxPriorityFeePerGas??0n,n=o??y.maxFeePerGas??0n}}return{maxFeePerGas:n,maxPriorityFeePerGas:i}}async function Fe(e){const{bundlerOptions:a,isDeployed:t,factoryContract:r,accountContract:c,adminAddress:n,sponsorGas:i,overrides:s,nonce:o,callData:u,callGasLimit:y,maxFeePerGas:l,maxPriorityFeePerGas:d,waitForDeployment:A}=e,{chain:h,client:g}=a;let G,f;t?(f="0x",A&&await ct(c)):(G=r.address,f=await H(at({accountSalt:s==null?void 0:s.accountSalt,adminAddress:n,createAccountOverride:s==null?void 0:s.createAccount,factoryContract:r})),A&&st(c));const m={callData:u,callGasLimit:y??0n,factory:G,factoryData:f,maxFeePerGas:l,maxPriorityFeePerGas:d,nonce:o,paymaster:void 0,paymasterData:"0x",paymasterPostOpGasLimit:0n,paymasterVerificationGasLimit:0n,preVerificationGas:0n,sender:c.address,signature:X,verificationGasLimit:0n};if(i){const p=await V({chain:h,client:g,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster,userOp:m});if(p.paymaster&&p.paymasterData&&(m.paymaster=p.paymaster,m.paymasterData=p.paymasterData),p.callGasLimit&&p.verificationGasLimit&&p.preVerificationGas&&p.paymasterPostOpGasLimit&&p.paymasterVerificationGasLimit)m.callGasLimit=p.callGasLimit,m.verificationGasLimit=p.verificationGasLimit,m.preVerificationGas=p.preVerificationGas,m.paymasterPostOpGasLimit=p.paymasterPostOpGasLimit,m.paymasterVerificationGasLimit=p.paymasterVerificationGasLimit;else{const w=s!=null&&s.tokenPaymaster?{[s.tokenPaymaster.tokenAddress]:{stateDiff:{[gt(Gt([{type:"address"},{type:"uint256"}],[c.address,s.tokenPaymaster.balanceStorageSlot]))]:Tt(vt,{size:32})}}}:void 0,T=await _({options:a,userOp:m},w);m.callGasLimit=T.callGasLimit,m.verificationGasLimit=T.verificationGasLimit,m.preVerificationGas=T.preVerificationGas,m.paymasterPostOpGasLimit=s!=null&&s.tokenPaymaster?500000n:T.paymasterPostOpGasLimit||0n,m.paymasterVerificationGasLimit=T.paymasterVerificationGasLimit||0n;const v=await V({chain:h,client:g,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster,userOp:m});v.paymaster&&v.paymasterData&&(m.paymaster=v.paymaster,m.paymasterData=v.paymasterData)}}else{const p=await _({options:a,userOp:m});m.callGasLimit=p.callGasLimit,m.verificationGasLimit=p.verificationGasLimit,m.preVerificationGas=p.preVerificationGas,m.paymasterPostOpGasLimit=p.paymasterPostOpGasLimit||0n,m.paymasterVerificationGasLimit=p.paymasterVerificationGasLimit||0n}return{...m,signature:"0x"}}async function Ee(e){const{bundlerOptions:a,isDeployed:t,factoryContract:r,accountContract:c,adminAddress:n,sponsorGas:i,overrides:s,nonce:o,callData:u,callGasLimit:y,maxFeePerGas:l,maxPriorityFeePerGas:d,waitForDeployment:A}=e,{chain:h,client:g}=a;let G;t?(G="0x",A&&await ct(c)):(G=await Ve({accountSalt:s==null?void 0:s.accountSalt,adminAddress:n,createAccountOverride:s==null?void 0:s.createAccount,factoryContract:r}),A&&st(c));const f={callData:u,callGasLimit:y??0n,initCode:G,maxFeePerGas:l,maxPriorityFeePerGas:d,nonce:o,paymasterAndData:"0x",preVerificationGas:0n,sender:c.address,signature:X,verificationGasLimit:0n};if(i){const m=await V({chain:h,client:g,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster,userOp:f}),p="paymasterAndData"in m?m.paymasterAndData:"0x";if(p&&p!=="0x"&&(f.paymasterAndData=p),m.callGasLimit&&m.verificationGasLimit&&m.preVerificationGas)f.callGasLimit=m.callGasLimit,f.verificationGasLimit=m.verificationGasLimit,f.preVerificationGas=m.preVerificationGas;else{const w=await _({options:a,userOp:f});if(f.callGasLimit=w.callGasLimit,f.verificationGasLimit=w.verificationGasLimit,f.preVerificationGas=w.preVerificationGas,p&&p!=="0x"){const T=await V({chain:h,client:g,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster,userOp:f}),v="paymasterAndData"in T?T.paymasterAndData:"0x";v&&v!=="0x"&&(f.paymasterAndData=v)}}}else{const m=await _({options:a,userOp:f});f.callGasLimit=m.callGasLimit,f.verificationGasLimit=m.verificationGasLimit,f.preVerificationGas=m.preVerificationGas}return{...f,signature:"0x"}}async function _e(e){const{userOp:a,chain:t,entrypointAddress:r,adminAccount:c}=e,n=await Ue({chain:t,client:e.client,entrypointAddress:r,userOp:a});if(c.signMessage){const i=await c.signMessage({chainId:t.id,message:{raw:Pt(n)},originalMessage:J(a)});return{...a,signature:i}}throw new Error("signMessage not implemented in signingAccount")}async function Ue(e){const{userOp:a,chain:t,entrypointAddress:r}=e,c=k(r||b);let n;if(c==="v0.7"){const i=De(a);n=await ve({contract:P({address:r||tt,chain:t,client:e.client}),userOp:i})}else n=await he({contract:P({address:r||b,chain:t,client:e.client}),userOp:a});return n}async function Ve(e){const{factoryContract:a,adminAddress:t,accountSalt:r,createAccountOverride:c}=e,n=at({accountSalt:r,adminAddress:t,createAccountOverride:c,factoryContract:a});return F([a.address,await H(n)])}async function Ie(e){const{accountContract:a,chain:t,client:r,entrypointAddress:c,getNonceOverride:n}=e;return n?n(a):await le({contract:P({address:c||b,chain:t,client:r}),key:xt(),sender:a.address})}async function ct(e){const a=Date.now();for(;it(e);){if(Date.now()-a>6e4)throw rt(e),new Error("Account deployment is taking too long (over 1 minute). Please try again.");await new Promise(t=>setTimeout(t,500))}}const ot=new WeakMap,$=new WeakMap;async function Ne(e,a){var A,h,g,G,f,m,p;const{personalAccount:t,client:r,chain:c}=e;if(!t)throw new Error("No personal account provided for smart account connection");const n=a,i=c??n.chain,s="gasless"in n?n.gasless:n.sponsorGas;if(await Lt(i))return[He({chain:i,connectionOptions:e,creationOptions:a,sponsorGas:s}),i];if(n.factoryAddress&&!((A=n.overrides)!=null&&A.entrypointAddress)){const w=await dt(n.factoryAddress,r,i);w&&(n.overrides={...n.overrides,entrypointAddress:w})}(h=n.overrides)!=null&&h.tokenPaymaster&&!((g=n.overrides)!=null&&g.entrypointAddress)&&(n.overrides={...n.overrides,entrypointAddress:tt});const o=n.factoryAddress??Ot((G=n.overrides)==null?void 0:G.entrypointAddress),u=P({address:o,chain:i,client:r}),y=await Rt({accountAddress:(f=n.overrides)==null?void 0:f.accountAddress,accountSalt:(m=n.overrides)==null?void 0:m.accountSalt,adminAddress:t.address,factoryContract:u,predictAddressOverride:(p=n.overrides)==null?void 0:p.predictAddress}).then(w=>w).catch(w=>{throw new Error(`Failed to get account address with factory contract ${u.address} on chain ID ${i.id}: ${(w==null?void 0:w.message)||"unknown error"}`,{cause:w})}),l=P({address:y,chain:i,client:r}),d=await Re({...n,accountContract:l,chain:i,client:r,factoryContract:u,personalAccount:t,sponsorGas:s});if(ot.set(t,d),$.set(d,t),n.sessionKey&&await oe({accountContract:l,newPermissions:n.sessionKey.permissions,sessionKeyAddress:n.sessionKey.address})){const w=ce({account:t,contract:l,permissions:n.sessionKey.permissions,sessionKeyAddress:n.sessionKey.address});await Dt({account:d,transaction:w})}return[d,i]}async function $e(e){const a=$.get(e);a&&(ot.delete(a),$.delete(e))}async function Re(e){var c,n;const a=(c=e.overrides)==null?void 0:c.tokenPaymaster;if(a&&k(((n=e.overrides)==null?void 0:n.entrypointAddress)||b)!=="v0.7")throw new Error("Token paymaster is only supported for entrypoint version v0.7");let t=e.accountContract;const r={address:et(t.address),async onTransactionRequested(i){var s,o;return(o=(s=e.personalAccount).onTransactionRequested)==null?void 0:o.call(s,i)},async sendBatchTransaction(i){var l,d;const s=kt({accountContract:t,executeBatchOverride:(l=e.overrides)==null?void 0:l.executeBatch,transactions:i});if(i.length===0)throw new Error("No transactions to send");const o=i[0];if(!o)throw new Error("No transactions to send");const u=E(o.chainId),y=await R({executeTx:s,options:{...e,accountContract:t,chain:u}});return U({chainId:u.id,client:e.client,contractAddress:((d=i[0])==null?void 0:d.to)??void 0,transactionHash:y.transactionHash,walletAddress:e.accountContract.address,walletType:"smart"}),y},async sendTransaction(i){var l,d,A;let s;if(a){await ke({accountContract:t,erc20Paymaster:a,options:e});const h=async()=>({paymaster:a.paymasterAddress,paymasterData:"0x"});s=((l=e.overrides)==null?void 0:l.paymaster)||h}else s=(d=e.overrides)==null?void 0:d.paymaster;i.chainId!==t.chain.id&&(t=P({address:r.address,chain:E(i.chainId),client:e.client}));const o=nt({accountContract:t,executeOverride:(A=e.overrides)==null?void 0:A.execute,transaction:i}),u=E(i.chainId),y=await R({executeTx:o,options:{...e,accountContract:t,chain:u,overrides:{...e.overrides,paymaster:s}}});return U({chainId:u.id,client:e.client,contractAddress:i.to??void 0,transactionHash:y.transactionHash,walletAddress:e.accountContract.address,walletType:"smart"}),y},async signMessage({message:i}){var o;if((o=e.overrides)!=null&&o.signMessage)return e.overrides.signMessage({accountContract:t,adminAccount:e.personalAccount,factoryContract:e.factoryContract,message:i});const{smartAccountSignMessage:s}=await N(async()=>{const{smartAccountSignMessage:u}=await import("./signing-3BqqlBFA.js");return{smartAccountSignMessage:u}},__vite__mapDeps([2,0,1,3,4,5,6]));return s({accountContract:t,factoryContract:e.factoryContract,message:i,options:e})},async signTypedData(i){var o;if((o=e.overrides)!=null&&o.signTypedData)return e.overrides.signTypedData({accountContract:t,adminAccount:e.personalAccount,factoryContract:e.factoryContract,typedData:i});const{smartAccountSignTypedData:s}=await N(async()=>{const{smartAccountSignTypedData:u}=await import("./signing-3BqqlBFA.js");return{smartAccountSignTypedData:u}},__vite__mapDeps([2,0,1,3,4,5,6]));return s({accountContract:t,factoryContract:e.factoryContract,options:e,typedData:i})}};return r}async function ke(e){var y;const{accountContract:a,erc20Paymaster:t,options:r}=e,c=t.tokenAddress,n=P({address:c,chain:a.chain,client:a.client});if(await qt({contract:n,owner:a.address,spender:t.paymasterAddress})>0n)return;const s=Zt({amountWei:me-1n,contract:n,spender:t.paymasterAddress}),o=await bt({from:a.address,transaction:s}),u=nt({accountContract:a,executeOverride:(y=r.overrides)==null?void 0:y.execute,transaction:o});await R({executeTx:u,options:{...r,overrides:{...r.overrides,tokenPaymaster:void 0}}})}function He(e){const{creationOptions:a,connectionOptions:t,chain:r}=e,c={address:et(t.personalAccount.address),async onTransactionRequested(n){var i,s;return(s=(i=t.personalAccount).onTransactionRequested)==null?void 0:s.call(i,n)},async sendTransaction(n){var y,l,d,A;const i={chain:E(n.chainId),client:t.client,data:n.data,eip712:n.eip712,to:n.to??void 0,value:n.value??0n};let s=await Nt({account:c,transaction:i});if(e.sponsorGas&&!s.paymaster){const h=await St({options:{bundlerUrl:(y=a.overrides)==null?void 0:y.bundlerUrl,chain:r,client:t.client,entrypointAddress:(l=a.overrides)==null?void 0:l.entrypointAddress},transaction:s});s={...s,...h}}const o=await $t({account:c,chainId:r.id,eip712Transaction:s}),u=await Ct({options:{bundlerUrl:(d=a.overrides)==null?void 0:d.bundlerUrl,chain:r,client:t.client,entrypointAddress:(A=a.overrides)==null?void 0:A.entrypointAddress},signedTransaction:o,transaction:s});return U({chainId:r.id,client:t.client,contractAddress:n.to??void 0,transactionHash:u.transactionHash,walletAddress:c.address,walletType:"smart"}),{chain:r,client:t.client,transactionHash:u.transactionHash}},async signMessage({message:n}){return t.personalAccount.signMessage({message:n})},async signTypedData(n){const i=Ft(n);return t.personalAccount.signTypedData(i)}};return c}async function R(e){var r,c,n;const{executeTx:a,options:t}=e;try{const i=await Se({accountContract:t.accountContract,adminAddress:t.personalAccount.address,factoryContract:t.factoryContract,overrides:t.overrides,sponsorGas:t.sponsorGas,transaction:a}),s=await _e({adminAccount:t.personalAccount,chain:t.chain,client:t.client,entrypointAddress:(r=t.overrides)==null?void 0:r.entrypointAddress,userOp:i}),o={bundlerUrl:(c=t.overrides)==null?void 0:c.bundlerUrl,chain:t.chain,client:t.client,entrypointAddress:(n=t.overrides)==null?void 0:n.entrypointAddress},u=await Et({options:o,userOp:s}),y=await be({...o,userOpHash:u});return U({chainId:t.chain.id,client:t.client,contractAddress:await L(a.to??void 0),transactionHash:y.transactionHash,walletAddress:t.accountContract.address,walletType:"smart"}),{chain:t.chain,client:t.client,transactionHash:y.transactionHash}}catch(i){throw _t(i)&&Ut({chainId:t.chain.id,client:t.client,contractAddress:await L(a.to??void 0),error:i,transactionValue:await L(a.value),walletAddress:t.accountContract.address}),i}finally{rt(t.accountContract)}}async function dt(e,a,t){const r=P({address:e,chain:t,client:a});try{return await x({contract:r,method:"function entrypoint() public view returns (address)"})}catch{return}}const qe=Object.freeze(Object.defineProperty({__proto__:null,connectSmartAccount:Ne,disconnectSmartAccount:$e,getEntrypointFromFactory:dt,isSmartWallet:Vt},Symbol.toStringTag,{value:"Module"}));export{qe as i,at as p};
